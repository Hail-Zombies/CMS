@{
    ViewBag.Title = "编辑器";
}

@Scripts.Render("~/bundles/uditor")

<ol class="breadcrumb">
    <li><a href="/">首页</a></li>
    <li class="active">编辑页</li>
</ol>

<div class="input-control has-label-left-lg" style="margin-top:0px">
    <input id="title" style="font-size:x-large" type="text" class="form-control" placeholder="">
    <label for="title" style="font-size:x-large" class="input-control-label-left text-right">标题：</label>
</div>
@*<div class="input-control has-label-left-lg" style="margin:5px 0px">
        <textarea id="abstract" style="font-size:large;padding-top:1px" type="text" class="form-control" placeholder="可不填"></textarea>
        <label for="abstract" style="font-size:x-large" class="input-control-label-left text-right">摘要：</label>
    </div>*@

<script id="editor" name="editor" type="text/plain"></script>

<button id="sub" class="btn btn-lg btn-primary" type="button" style="margin: 5px 2px;float: right;">
    <i class="icon icon-save"></i>&nbsp提交
</button>

@* <script type="text/javascript">
    var ue = UE.getEditor('editor');
    </script> *@

<script type="text/javascript">
    var ue = UE.getEditor('editor',
        {
            toolbars:
                [

                    ['fullscreen', 'undo', 'redo', '|',
                        'customstyle', 'paragraph', 'fontfamily', 'fontsize', '|',
                        'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist', 'selectall', 'cleardoc', '|',
                        'simpleupload', 'insertimage', 'insertvideo', 'attachment', 'pagebreak', 'template', 'background'],

                    ['print', 'preview', 'searchreplace', 'drafts', 'help',

                        '|', 'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|',
                        'imagenone', 'imageleft', 'imageright', 'imagecenter',

                        '|', 'indent', 'rowspacingtop', 'rowspacingbottom', 'lineheight', '|',

                        'link', 'unlink', 'anchor', '|',
                        'horizontal', 'date', 'time', 'spechars', 'snapscreen', 'wordimage', '|',

                        'inserttable', 'deletetable', 'insertparagraphbeforetable', 'insertrow', 'deleterow', 'insertcol', 'deletecol', 'mergecells', 'mergeright', 'mergedown', 'splittocells', 'splittorows', 'splittocols', 'charts'
                    ]
                ],
            autoHeightEnabled: true,
            initialFrameWidth: '100%',
            initialFrameHeight: 500
        });
    $(document).ready(function () {
        var data;
        $("#sub").click(function () {

            var article = {
                "Title": "",
                "Author": "3000000",
                "Content": "",
                "Class": "栏目一",
                "Abstract": "",
            };

            article.Title = $("#title").val();
            /*article.Abstract = $("#abstract").val();*/
            article.Content = ue.getContent();

            var plain = ue.getPlainTxt().split("\n").filter(item => item != /\s/g);
            if (plain.length >= 2) {
                var num = 0;
                //for (var i = num; i < plain.length; i++) {
                //    if (plain[i].replace(/\s/g, "") == "")
                //        continue;
                //    else {
                //        article.Title = plain[i].substring(0, 199);
                //        num = i + 1;
                //        break;
                //    }
                //}
                for (var i = num; i < plain.length; i++) {
                    if (plain[i].replace(/\s/g, "") == "")
                        continue;
                    else {
                        article.Abstract = plain[i].substring(0, 499).replace(/\s/g, "");
                        break;
                    }
                }
            }

            if (article.Title.replace(/\s/g, "") == "") {
                alert("请填写标题");
                return;
            }
            if (article.Content == "") {
                alert("请输入内容");
                return;
            }
            if (article.Title.length > 200) {
                alert("标题过长");
                return;
            }
            if (article.Abstract.length > 500) {
                alert("摘要过长");
                return;
            }

            data = JSON.stringify(article);
            $.ajax(
                {
                    type: 'POST',
                    url: 'Submit',
                    contentType: "application/json",
                    dataType: "json",
                    data: data,
                    success: function (data) {
                        alert(JSON.parse(data).message);
                    },
                    error: function (error) {
                        console.log(error);
                        alert("提交失败");
                    }
                })
        })
    });
</script>